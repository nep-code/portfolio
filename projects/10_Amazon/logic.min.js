(function(){var e,t,i,n,o,c,a=(e=["src/bg.jpg","src/logo.png","src/intro-title.png","src/intro-cta-mic.png","src/intro-cta-no-mic.png","src/intro-cta-no-mic-white.png","src/intro-cta-mic-white.png","src/cta-mic.png","src/cta-mic-no.png","src/cta.png","src/mic-ico.png","src/bg-blur.jpg","src/shadow.png","src/alexa-aliens.png","src/alexa-barrel.png","src/alexa-bedtime.png","src/alexa-jetpack.png","src/alexa-lights.png","src/alexa-toilet.png","src/mic-text.png","src/mic-circle.png","src/mic-off.png","src/mic-circle-animation.png","src/mic.png","src/timeout-title.png","src/timeout-cta-mic.png","src/timeout-cta-no-mic.png"],t=[],i=0,n=e.length+t.length,o=!1,c="ontouchstart"in document.documentElement,{loadedAssets:i,totalAssets:n,is_started:o,init_Images:e,init_JS:t,is_mobile:c}),s=function(){function e(){t(a.init_Images),i(a.init_JS)}function t(e){for(let t=0;t<e.length;t++){let i=e[t];$("<img />").attr("src",i).on("load",n)}}function i(e){for(let t=0;t<e.length;t++){let i=e[t];$.getScript(i,n)}}function n(){a.loadedAssets+=1,a.loadedAssets==a.totalAssets&&l.init()}return{init:e}}(),r={},l=function(){function e(){l.updateScale(),$(window).resize(t),d.init()}function t(){var e=$("#container").css("transform");if("none"!=e)try{var t=e.split("(")[1];t=t.split(")")[0],t=t.split(",");var i=t[0],n=t[1];r.scale=Math.sqrt(i*i+n*n)}catch(e){r.scale=1}else r.scale=1}return{init:e,updateScale:t}}(),d=function(){function e(){function e(){t(),i()}function t(){T.introContainer=document.querySelector(".intro-container"),T.base=document.querySelector(".base"),T.cta=document.querySelector(".cta"),T.alexa=document.querySelectorAll(".alexa"),T.shadow=document.querySelector(".shadow"),T.micText=document.querySelector(".mic-text"),T.mic=document.querySelector(".mic"),T.micAnimation=document.querySelector(".mic-animation"),T.micCircle=document.querySelector(".mic-circle"),T.micCircleAnimation=document.querySelector(".mic-circle-animation"),T.micButton=document.querySelector(".mic-button"),T.micOff=document.querySelector(".mic-off"),T.transition=document.querySelector(".transition"),T.timeout=document.querySelector(".timeout"),T.alexaPrompt=document.querySelector(".alexa-prompt"),T.alexaPromptText=document.querySelector(".alexa-prompt-text"),T.video=document.querySelector("#video"),T.introVideo=document.querySelector("#intro-video"),T.onVideo=document.querySelector("#on-video"),T.offVideo=document.querySelector("#off-video"),T.baseOnVideo=document.querySelector("#base-on-video"),T.click=document.querySelector(".click")}function i(){n(),o()}function n(){function e(e){T.alexa[e].addEventListener("click",function(){L(this.id)},!1)}document.querySelector("#continue-with-mic").addEventListener("click",p,!1),document.querySelector("#continue-without-mic").addEventListener("click",S,!1),document.querySelector("#timeout-continue-with-mic").addEventListener("click",p,!1),document.querySelector("#timeout-continue-without-mic").addEventListener("click",S,!1),T.video.addEventListener("timeupdate",h,!1),T.video.addEventListener("ended",x,!1),r.recognition&&T.micButton.addEventListener("click",f,!1),T.cta.addEventListener("click",c,!1);for(var t=0;t<T.alexa.length;++t)e(t)}function o(){T.introContainer.classList.add("animate"),T.introVideo.src="src/video/intro-video.mp4"}function c(){window.open("https://www.amazon.com/","_blank")}function a(){T.onVideo.classList.add("animate"),T.onVideo.play(),setTimeout(function(){T.onVideo.classList.remove("animate"),T.offVideo.classList.add("animate"),T.offVideo.play(),setTimeout(function(){T.offVideo.classList.remove("animate")},1e3)},1500)}function s(e){if(Y=!1,T.introVideo.volume=.5,T.introVideo.muted=!1,!1,W=!1,T.timeout.style.display="none",T.timeout.classList.remove("animate"),T.introContainer.classList.remove("animate"),T.cta.style.display="block",T.base.style.display="block",setTimeout(function(){T.base.classList.add("animate"),T.cta.classList.add("animate"),T.alexa[0].classList.add("animate"),setTimeout(function(){T.alexa[1].classList.add("animate")},120),setTimeout(function(){T.alexa[2].classList.add("animate")},240),setTimeout(function(){T.alexa[3].classList.add("animate")},360),setTimeout(function(){T.alexa[4].classList.add("animate")},480),setTimeout(function(){T.alexa[5].classList.add("animate")},480)},150),T.shadow.classList.add("animate"),e){T.click.classList.remove("animate");var t={audio:!0,video:!1};navigator.mediaDevices.getUserMedia(t).then(function(){U=!0,T.videoAliensSrc="src/video/no_utterance/videoAliensSrc.mp4",T.videoBarrelSrc="src/video/no_utterance/videoBarrelSrc.mp4",T.videoBedtimeSrc="src/video/no_utterance/videoBedtimeSrc.mp4",T.videoJetpackSrc="src/video/no_utterance/videoJetpackSrc.mp4",T.videoLightsSrc="src/video/no_utterance/videoLightsSrc.mp4",T.videoToiletSrc="src/video/no_utterance/videoToiletSrc.mp4",H?(d(),v(!1),setTimeout(function(){T.micButton.classList.remove("disabled")},500),V.start()):(navigator.mediaDevices.getUserMedia(t).then(function(){}).catch(function(e){U=!1,alert("No Microphone Access"),s(!1)}),H=!0,v(!1),setTimeout(function(){m.PLAY(m.SND_WELCOME)},300),a(),setTimeout(function(){d(),T.micButton.classList.remove("disabled"),V.start()},14e3))}).catch(function(e){U=!1,S()})}else U=!1,T.click.classList.add("animate"),T.videoAliensSrc="src/video/utterance/videoAliensSrc.mp4",T.videoBarrelSrc="src/video/utterance/videoBarrelSrc.mp4",T.videoBedtimeSrc="src/video/utterance/videoBedtimeSrc.mp4",T.videoJetpackSrc="src/video/utterance/videoJetpackSrc.mp4",T.videoLightsSrc="src/video/utterance/videoLightsSrc.mp4",T.videoToiletSrc="src/video/utterance/videoToiletSrc.mp4",j?(u(),v(!0),setTimeout(function(){T.micButton.classList.remove("disabled"),setTimeout(function(){T.click.classList.remove("animate")},5e3)},500)):(j=!0,setTimeout(function(){setTimeout(function(){m.PLAY(m.SND_ACCESSGRANTED)},700),a()},250),setTimeout(function(){u(),v(!0),T.micButton.classList.remove("disabled"),setTimeout(function(){T.click.classList.remove("animate")},5e3)},2e3));b(),y()}function l(){T.micOff.classList.remove("animate"),T.micAnimation.classList.add("animate"),T.micCircle.classList.remove("hide"),T.mic.classList.remove("hide"),T.micText.classList.remove("animate"),T.micCircleAnimation.classList.add("hide"),T.micCircleAnimation.classList.remove("animate")}function d(){T.micOff.classList.remove("animate"),T.micAnimation.classList.add("animate"),T.micCircle.classList.add("hide"),T.mic.classList.remove("hide"),T.micText.classList.add("animate"),T.micCircleAnimation.classList.remove("hide"),T.micCircleAnimation.classList.add("animate")}function u(){T.micOff.classList.add("animate"),T.micAnimation.classList.add("animate"),T.micCircle.classList.add("hide"),T.mic.classList.add("hide"),T.micText.classList.remove("animate"),T.micCircleAnimation.classList.add("hide"),T.micCircleAnimation.classList.remove("animate")}function v(e){if(e)for(let e=0;e<T.alexa.length;++e)T.alexa[e].classList.add("pointers");else for(let e=0;e<T.alexa.length;++e)T.alexa[e].classList.remove("pointers")}function f(){T.micButton.classList.add("disabled"),U?(U=!1,V.stop(),S()):(U=!0,p())}function p(){if(T.micButton.classList.add("disabled"),Y)for(var e=0;e<T.alexa.length;++e)T.alexa[e].classList.remove("disabled");l(),s(!0)}function S(){if(Y)for(var e=0;e<T.alexa.length;++e)T.alexa[e].classList.add("disabled");u(),s(!1)}function L(e){const t={aliens:{msg:"“Alexa, do aliens exist?”",url:T.videoAliensSrc},barrel:{msg:"“Alexa, do a barrel roll”",url:T.videoBarrelSrc},bedtime:{msg:"“Alexa, turn on bedtime”",url:T.videoBedtimeSrc},jetpack:{msg:"“Alexa, fire jetpack thrusters”",url:T.videoJetpackSrc},lights:{msg:"“Alexa, turn off the lights”",url:T.videoLightsSrc},toilet:{msg:"“Alexa, flush the toilet”",url:T.videoToiletSrc}};T.alexaPromptText.innerHTML="",msg="",t[e]?(A=!0,msg=t[e].msg,T.video.src=t[e].url):(V.stop(),A=!1,E=!0,m.PLAY(m.SND_SORRY),setTimeout(function(){E=!1,U&&V.start()},2e3)),A?g():y()}function g(){m.PAUSE(m.SND_WELCOME),m.PAUSE(m.SND_ACCESSGRANTED),T.micButton.classList.add("disabled"),T.introVideo.volume=0,T.transition.classList.add("animate"),r.recognition&&V.stop(),setTimeout(function(){N?x():(!1,W=!1,b(),T.video.classList.add("animate"),T.video.play())},500)}function h(){I=!0}function x(){O="",T.introVideo.volume=.5,T.transition.classList.remove("animate"),T.micButton.classList.remove("disabled"),setTimeout(function(){T.video.classList.remove("animate"),A=!1,I=!1,U&&r.recognition&&V.start(),y()},500)}function y(){W||I||!r.recognition||(clearTimeout(P),W=!0,P=setTimeout(function(){V.stop(),U=!1,!0,T.base.style.display="none",T.cta.classList.remove("animate"),T.base.classList.remove("animate"),T.timeout.style.display="block",setTimeout(function(){T.timeout.classList.add("animate")},150),l()},3e4))}function b(){clearTimeout(P)}var T={videoSrc:""},A=!1,E=!1;try{var w=w||webkitSpeechRecognition,k=k||webkitSpeechGrammarList,q=q||webkitSpeechRecognitionEvent;r.recognition=!0;var _,C,V=new w,B=new k;V.grammars=B,V.continuous=!1,V.lang="en-US",V.interimResults=!0,V.maxAlternatives=1;var N=!1;function D(){document[_]?(N=!0,V.stop()):(N=!1,U&&V.start())}void 0!==document.hidden?(_="hidden",C="visibilitychange"):void 0!==document.msHidden?(_="msHidden",C="msvisibilitychange"):void 0!==document.webkitHidden&&(_="webkitHidden",C="webkitvisibilitychange"),void 0===document.addEventListener||void 0===_?$(body).css("background","red"):document.addEventListener(C,D,!1),V.onresult=function(e){var t=e.results.length-1;O=e.results[t][0].transcript.toLowerCase(),J=!0,O.includes("alexa")&&G&&(G=!1,clearTimeout(M),T.onVideo.classList.add("animate"),T.onVideo.play(),M=setTimeout(function(){T.baseOnVideo.classList.add("animate"),T.baseOnVideo.play(),T.onVideo.classList.remove("animate")},1e3)),R.textContent=O},V.onspeechend=function(){G||(G=!0,setTimeout(function(){clearTimeout(M),T.baseOnVideo.classList.remove("animate"),T.onVideo.classList.remove("animate"),T.offVideo.classList.add("animate"),T.offVideo.play(),T.offVideo.classList.remove("animate")},2200)),setTimeout(function(){A||N||!J||(T.micButton.classList.add("disabled"),b(),O.includes("alexa")&&O.includes("do")&&O.includes("aliens")&&O.includes("exist")?(J=!1,L("aliens")):O.includes("alexa")&&O.includes("do")&&O.includes("barrel")&&O.includes("roll")?(J=!1,L("barrel")):O.includes("alexa")&&O.includes("turn")&&O.includes("on")&&O.includes("bedtime")?(J=!1,L("bedtime")):O.includes("alexa")&&O.includes("fire")&&O.includes("jetpack")||O.includes("thrusters")?(J=!1,L("jetpack")):O.includes("alexa")&&O.includes("turn")&&O.includes("off")&&O.includes("lights")?(J=!1,L("lights")):O.includes("alexa")&&O.includes("flash")&&O.includes("the")&&O.includes("toilet")?(J=!1,L("toilet")):(J=!1,L("no-prompt"),T.micButton.classList.remove("disabled")))},500)},V.onspeechstart=function(){},V.onnomatch=function(){R.textContent="I didn't recognise that."},V.onerror=function(e){if(R.textContent="Error occurred in recognition: "+e.error,"not-allowed"==e.error){U=!1,alert("No Microphone Access");for(var t=0;t<T.alexa.length;++t)T.alexa[t].classList.add("disabled");s(!1)}},V.onend=function(){A||E||!U||N||V.start()}}catch(e){r.recognition=!1,document.querySelector("#continue-with-mic").style.display="none",document.querySelector("#continue-without-mic").style.float="none",document.querySelector(".mic-button").style.pointerEvents="none"}var O,M,P,R=document.querySelector(".output"),U=!1,j=!1,H=!1,Y=!0,I=!1,J=!1,G=!0,W=!1;e()}return{init:e}}(),m={ASSETS:[["SND_BGM",{src:["src/audio/bgm.mp3"],loop:!0,volume:1}],["SND_ACCESSGRANTED",{src:["src/audio/sfx_accessgranted.mp3"],loop:!1,volume:1}],["SND_WELCOME",{src:["src/audio/sfx_welcome.mp3"],loop:!1,volume:1}],["SND_SORRY",{src:["src/audio/sfx_sorry.mp3"],loop:!1,volume:1}]],INIT:function(e){$.getScript("https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js",m.READY)},READY:function(e){for(let e=0;e<m.ASSETS.length;e++)m.ASSETS[e][1].preload=!0,m[m.ASSETS[e][0]]=new Howl(m.ASSETS[e][1]);m.PLAY(m.SND_BGM),s.init()},PLAY:function(e){e.playing()?m.SEEK(e,0):e.play()},PAUSE:function(e){e.pause()},STOP:function(e){e.stop()},MUTE:function(e){e.volume(0)},UNMUTE:function(e){e.volume(1)},SEEK:function(e,t){e.seek(t)},VOLUME_ON:function(){Howler.volume(1)},VOLUME_OFF:function(){Howler.volume(0)},END:function(e){Howler.unload()}};m.INIT()})();
